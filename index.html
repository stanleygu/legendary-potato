<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connections Word Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation; /* Prevents double-tap to zoom on mobile */
        }
        .card {
            transition: transform 0.2s ease-in-out, background-color 0.2s ease-in-out;
        }
        .card.selected {
            transform: translateY(-8px);
            background-color: #60a5fa; /* A nice blue for selection */
            color: white;
        }
        .card.solved {
            animation: flip-and-settle 0.8s forwards;
            background-color: #a3e635; /* A vibrant green for solved */
            color: black;
            cursor: default;
        }
        .solved-category {
            opacity: 0;
            transform: translateY(20px);
            animation: slide-in 0.5s forwards;
        }
        @keyframes slide-in {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes flip-and-settle {
            0% { transform: rotateX(0) translateY(-8px); }
            50% { transform: rotateX(90deg) translateY(-8px); }
            100% { transform: rotateX(0) translateY(0); }
        }
        .mistake-dot {
            transition: background-color 0.3s ease;
        }
        .mistake-dot.used {
            background-color: #9ca3af;
        }
        #message-box {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .toast-enter {
            opacity: 0;
            transform: translateY(20px);
        }
        .toast-leave {
            opacity: 0;
            transform: translateY(20px);
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 flex flex-col items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-2xl mx-auto">
        <header class="text-center mb-4">
            <h1 class="text-3xl sm:text-4xl font-bold">Connections</h1>
            <p class="text-sm sm:text-base text-gray-600 dark:text-gray-400">Group four words that share something in common.</p>
        </header>

        <!-- Solved Categories will be prepended here -->
        <div id="solved-container" class="grid grid-cols-1 gap-2 mb-4"></div>

        <!-- Word Grid -->
        <div id="word-grid" class="grid grid-cols-4 gap-2 sm:gap-3 mb-4">
            <!-- Words will be dynamically inserted here -->
        </div>

        <!-- Message Box -->
        <div id="message-box" class="h-8 text-center flex items-center justify-center mb-4">
             <p id="message-text" class="text-base font-medium opacity-0 transition-opacity duration-300"></p>
        </div>


        <!-- Mistakes Tracker -->
        <div class="flex items-center justify-center mb-6">
            <span class="mr-2 text-sm sm:text-base">Mistakes remaining:</span>
            <div id="mistakes-tracker" class="flex space-x-2">
                <div class="mistake-dot w-4 h-4 rounded-full bg-gray-400 dark:bg-gray-600"></div>
                <div class="mistake-dot w-4 h-4 rounded-full bg-gray-400 dark:bg-gray-600"></div>
                <div class="mistake-dot w-4 h-4 rounded-full bg-gray-400 dark:bg-gray-600"></div>
                <div class="mistake-dot w-4 h-4 rounded-full bg-gray-400 dark:bg-gray-600"></div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-center space-x-2 sm:space-x-4">
            <button id="shuffle-button" class="px-4 py-2 sm:px-6 sm:py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-full font-semibold shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 transition">Shuffle</button>
            <button id="deselect-button" class="px-4 py-2 sm:px-6 sm:py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-full font-semibold shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 transition">Deselect all</button>
            <button id="submit-button" class="px-4 py-2 sm:px-6 sm:py-3 bg-blue-500 text-white rounded-full font-semibold shadow-sm hover:bg-blue-600 transition disabled:bg-gray-400 disabled:cursor-not-allowed">Submit</button>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 sm:p-8 w-full max-w-md text-center">
            <h2 id="modal-title" class="text-2xl sm:text-3xl font-bold mb-2"></h2>
            <p id="modal-subtitle" class="mb-6 text-gray-600 dark:text-gray-400"></p>
            <div id="modal-results" class="space-y-2 mb-6">
                <!-- Final results will be shown here -->
            </div>
            <button id="play-again-button" class="w-full px-6 py-3 bg-blue-500 text-white rounded-full font-semibold hover:bg-blue-600 transition">Play Again</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- GAME DATA ---
            const puzzles = [
                [ // Puzzle 1
                    { category: "PARTS OF A SHOE", words: ["Lace", "Sole", "Tongue", "Heel"], level: 1 },
                    { category: "HORSE GAITS", words: ["Trot", "Canter", "Gallop", "Pace"], level: 2 },
                    { category: "TO SHRED ____", words: ["Paper", "Cheese", "Waves", "Evidence"], level: 3 },
                    { category: "WORDS STARTING WITH ROMAN NUMERALS", words: ["Mix", "Dice", "Live", "Civic"], level: 4 }
                ],
                [ // Puzzle 2
                    { category: "DESSERTS", words: ["Pie", "Cake", "Tart", "Brownie"], level: 1 },
                    { category: "CAR MODELS", words: ["Focus", "Civic", "Pilot", "Legend"], level: 2 },
                    { category: "CAN BE SEALED", words: ["Deal", "Lips", "Fate", "Envelope"], level: 3 },
                    { category: "FILM DIRECTORS, MINUS FIRST NAME", words: ["Anderson", "Coppola", "Gerwig", "Nolan"], level: 4 }
                ],
                [ // Puzzle 3
                    { category: "THINGS ON A DESK", words: ["Stapler", "Lamp", "Pen", "Mouse"], level: 1 },
                    { category: "LUXURY WATCH BRANDS", words: ["Rolex", "Omega", "Patek", "Cartier"], level: 2 },
                    { category: "CLASSIC ROCK BANDS", words: ["Queen", "Genesis", "Rush", "Yes"], level: 3 },
                    { category: "CONTRONYMS", words: ["Dust", "Seed", "Cleave", "Sanction"], level: 4 }
                ],
                [ // Puzzle 4
                    { category: "MAKEUP", words: ["Lipstick", "Mascara", "Eyeliner", "Foundation"], level: 1 },
                    { category: "SAUCES", words: ["Hollandaise", "Marinara", "Pesto", "Alfredo"], level: 2 },
                    { category: "RELATED TO A VOLCANO", words: ["Ash", "Lava", "Cone", "Magma"], level: 3 },
                    { category: "STARTS WITH THE SAME 3 LETTERS", words: ["Paramount", "Paragon", "Parasite", "Parable"], level: 4 }
                ]
            ];

            const categoryColors = {
                1: 'bg-yellow-300 dark:bg-yellow-600',
                2: 'bg-green-300 dark:bg-green-600',
                3: 'bg-blue-300 dark:bg-blue-600',
                4: 'bg-purple-300 dark:bg-purple-600',
            };

            // --- STATE VARIABLES ---
            let gameData = [];
            let words = [];
            let selectedWords = [];
            let mistakes = 0;
            const MAX_MISTAKES = 4;
            let solvedCategories = [];
            let playedPuzzleIndices = [];

            // --- DOM ELEMENTS ---
            const grid = document.getElementById('word-grid');
            const submitButton = document.getElementById('submit-button');
            const shuffleButton = document.getElementById('shuffle-button');
            const deselectButton = document.getElementById('deselect-button');
            const mistakesTracker = document.getElementById('mistakes-tracker').children;
            const solvedContainer = document.getElementById('solved-container');
            const messageText = document.getElementById('message-text');
            const modal = document.getElementById('game-over-modal');
            
            // --- INITIALIZATION ---
            function initGame() {
                // Select a new, unplayed puzzle
                if (playedPuzzleIndices.length === puzzles.length) {
                    playedPuzzleIndices = []; // Reset if all puzzles have been played
                }
                let puzzleIndex;
                do {
                    puzzleIndex = Math.floor(Math.random() * puzzles.length);
                } while (playedPuzzleIndices.includes(puzzleIndex));
                
                playedPuzzleIndices.push(puzzleIndex);
                gameData = puzzles[puzzleIndex];

                // Reset state
                selectedWords = [];
                mistakes = 0;
                solvedCategories = [];

                // Flatten words from data and shuffle
                words = gameData.flatMap(cat => cat.words.map(word => ({ text: word, category: cat.category, level: cat.level })));
                shuffleWords(words);

                // Clear UI
                grid.innerHTML = '';
                solvedContainer.innerHTML = '';
                modal.classList.add('hidden');
                document.getElementById('modal-results').innerHTML = '';

                // Render UI
                renderGrid();
                updateMistakesTracker();
                updateSubmitButton();
            }

            // --- RENDERING & UI UPDATES ---
            function renderGrid() {
                grid.innerHTML = ''; // Clear previous grid
                const currentWords = words.filter(wordObj => !solvedCategories.find(sc => sc.category === wordObj.category));
                shuffleWords(currentWords); // Shuffle remaining words for display
                currentWords.forEach(wordObj => {
                    const card = document.createElement('div');
                    card.textContent = wordObj.text;
                    card.dataset.word = wordObj.text;
                    card.dataset.category = wordObj.category;
                    card.className = "card flex items-center justify-center h-16 sm:h-20 bg-gray-200 dark:bg-gray-700 rounded-lg cursor-pointer font-medium text-center p-1 text-sm sm:text-base";
                    card.addEventListener('click', () => handleWordClick(card));
                    grid.appendChild(card);
                });
            }

            function updateSubmitButton() {
                submitButton.disabled = selectedWords.length !== 4;
            }

            function updateMistakesTracker() {
                Array.from(mistakesTracker).forEach((dot, index) => {
                    if (index < mistakes) {
                        dot.classList.add('used');
                    } else {
                        dot.classList.remove('used');
                    }
                });
            }

            function showMessage(text, isError = false) {
                 messageText.textContent = text;
                 messageText.style.color = isError ? '#f87171' : '#4ade80'; // red for error, green for success
                 messageText.classList.remove('opacity-0');

                 setTimeout(() => {
                     messageText.classList.add('opacity-0');
                 }, 1500);
            }

            // --- EVENT HANDLERS ---
            function handleWordClick(card) {
                const word = card.dataset.word;
                if(card.classList.contains('solved')) return; // Ignore clicks on solved words

                if (selectedWords.includes(word)) {
                    // Deselect
                    selectedWords = selectedWords.filter(w => w !== word);
                    card.classList.remove('selected');
                } else {
                    // Select
                    if (selectedWords.length < 4) {
                        selectedWords.push(word);
                        card.classList.add('selected');
                    }
                }
                updateSubmitButton();
            }

            shuffleButton.addEventListener('click', () => {
                renderGrid(); // Re-renders the grid which includes shuffling
            });

            deselectButton.addEventListener('click', () => {
                selectedWords = [];
                document.querySelectorAll('.card.selected').forEach(card => card.classList.remove('selected'));
                updateSubmitButton();
            });

            submitButton.addEventListener('click', handleSubmit);
            
            document.getElementById('play-again-button').addEventListener('click', initGame);

            // --- GAME LOGIC ---
            function handleSubmit() {
                if (selectedWords.length !== 4) return;

                const firstWordData = words.find(w => w.text === selectedWords[0]);
                if (!firstWordData) return; // Should not happen
                
                const firstWordCategory = firstWordData.category;
                const isCorrect = selectedWords.every(word => words.find(w => w.text === word)?.category === firstWordCategory);
                
                if (isCorrect) {
                    handleCorrectGuess(firstWordCategory);
                } else {
                    handleIncorrectGuess();
                }
            }

            function handleCorrectGuess(category) {
                 showMessage('Correct!', false);
                const categoryData = gameData.find(c => c.category === category);
                solvedCategories.push(categoryData);
                
                // Sort by level to show easier categories first
                solvedCategories.sort((a,b) => a.level - b.level);
                
                renderSolvedCategories();
                renderGrid(); // Re-render the grid to remove solved words

                // Clear selection
                selectedWords = [];
                updateSubmitButton();

                if (solvedCategories.length === gameData.length) {
                    endGame(true); // Win
                }
            }
            
            function renderSolvedCategories() {
                solvedContainer.innerHTML = '';
                solvedCategories.forEach((cat, index) => {
                    const solvedRow = document.createElement('div');
                    solvedRow.className = `solved-category p-4 rounded-lg text-center ${categoryColors[cat.level]}`;
                    solvedRow.style.animationDelay = `${index * 100}ms`;
                    solvedRow.innerHTML = `
                        <p class="font-bold text-black">${cat.category}</p>
                        <p class="font-medium text-black">${cat.words.join(', ')}</p>
                    `;
                    solvedContainer.appendChild(solvedRow);
                });
            }

            function handleIncorrectGuess() {
                mistakes++;
                updateMistakesTracker();
                showMessage('Incorrect, try again.', true);
                
                // Deselect words after a brief shake
                const selectedCards = document.querySelectorAll('.card.selected');
                selectedCards.forEach(card => {
                    card.classList.add('animate-shake');
                });
                
                // Shake animation using Tailwind keyframes
                const styleSheet = document.createElement("style");
                styleSheet.innerText = `@keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0) translateY(-8px); } 20%, 80% { transform: translate3d(2px, 0, 0) translateY(-8px); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0) translateY(-8px); } 40%, 60% { transform: translate3d(4px, 0, 0) translateY(-8px); } } .animate-shake { animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both; }`;
                document.head.appendChild(styleSheet);
                
                setTimeout(() => {
                    selectedCards.forEach(card => {
                        card.classList.remove('animate-shake');
                        card.classList.remove('selected');
                    });
                    selectedWords = [];
                    updateSubmitButton();
                }, 820);


                if (mistakes >= MAX_MISTAKES) {
                    endGame(false); // Lose
                }
            }

            function endGame(isWin) {
                setTimeout(() => {
                    const modalTitle = document.getElementById('modal-title');
                    const modalSubtitle = document.getElementById('modal-subtitle');
                    const modalResults = document.getElementById('modal-results');

                    if (isWin) {
                        modalTitle.textContent = "Congratulations!";
                        modalSubtitle.textContent = "You found all the connections.";
                    } else {
                        modalTitle.textContent = "Next Time!";
                        modalSubtitle.textContent = "Here are the answers:";
                    }
                    
                    // Display all categories in order
                    const allCategoriesSorted = [...gameData].sort((a, b) => a.level - b.level);
                    modalResults.innerHTML = '';
                    allCategoriesSorted.forEach(cat => {
                       const resultRow = document.createElement('div');
                       resultRow.className = `p-3 rounded-lg text-left ${categoryColors[cat.level]}`;
                       resultRow.innerHTML = `
                        <p class="font-bold text-black">${cat.category}</p>
                        <p class="font-medium text-black">${cat.words.join(', ')}</p>
                       `;
                       modalResults.appendChild(resultRow);
                    });
                    
                    modal.classList.remove('hidden');
                }, 1000);
            }

            // --- UTILITY FUNCTIONS ---
            function shuffleWords(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            // --- START ---
            initGame();
        });
    </script>
</body>
</html>
